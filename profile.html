<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASACAFE</title>
    <link rel="icon" href="temp casaLogo.png" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="profile.css">
</head>
<body>

    <header>
        <input type="checkbox" name="" id="toggler">
        <label for="toggler" class="fas fa-bars"></label>
        <a href="index copy.html" class="logo"><img src="temp casaLogo.png"><span></span></a>

        <nav class="nav-bar">
            <a href="wishlist.html" id="navWish">
                <!-- <img src="heart outline.jpg"> -->
                <i class="fa-regular fa-heart wishlist-icon"></i>
            </a>    
            <a href="cart.html" id="navCart">Cart</a>
            <a href="index copy.html">home</a>
            <a href="product.html">Menu</a>
            <a href="index.html">log out</a>
            <a href="profile.html" id="profileBtn">
                <img src="profile.png">
            </a>
        </nav>
    </header>

    <div class="profileAndOrders">
    <section class="profileDetail">
        <h1>Profile</h1>

        <div class="prof">
            <img src="profile.png" id="profImg">
            <div class="text-content">
                <h2 id="usernameDisplay"></h2>
                <button class="edit-btn" data-id="${user.UserID}" data-username="${user.Username}"><i class="fas fa-pen"></i></button>
                <p>Edit Profile</p>
            </div>
        </div>

    <div class="profileOptions">
        <div class="profileOptionItem">
            <a href="profile.html">
                <img src="account.jpg" class="accImg">
            </a>
            <a href="profile.html">My Account</a>
        </div>
    </div>
    </section>
    <!--a href="cart.html">My Purchase</a-->

    <div class="modal active" id="editModal">
        <div class="modal-content">
          <h3>Edit Username</h3>
          <input type="text" id="editUsernameInput" />
          <div>
            <button class="confirm-btn" id="saveEditBtn">Save</button>
            <button class="cancel-btn" onclick="closeModal('editModal')">Cancel</button>
          </div>
        </div>
    </div>

    <section class="orderHistory">
  <div>
    <h2>History</h2>
    <hr style="border: none; height: 2px; background-color: black; margin: 10px auto; width: 100%;">
    <section id="purchasedSection">
      <div id="purchasedItemsContainer"></div>
    </section>
  </div>
</section>


</div>

  <section class="footer">

    <div class="credit"> created by <span> Althea Telmo ,Jules Ni√±o Adrian Lada, Francisco Jubelag Jr XX, Casmir Ballesteros</span></div>
  </section>
  <script src="script.js"></script>
  <script src="profile.js"></script>
  <script>
    const editModal = document.getElementById("editModal");
    const editUsernameInput = document.getElementById("editUsernameInput");

    function openModal(id) {
      document.getElementById(id).classList.add("active");
    }

    function closeModal(id) {
      document.getElementById(id).classList.remove("active");
    }

    document.getElementById('saveEditBtn').addEventListener('click', () => {
      const newUsername = editUsernameInput.value.trim();
      if (newUsername && selectedUserId) {
        fetch('admin_edit_users.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: `UserID=${selectedUserId}&Username=${encodeURIComponent(newUsername)}`
        })
        .then(res => res.json())
        .then(data => {
          if (data.success) {
            closeModal('editModal');
            location.reload();
          } else {
            alert('Edit failed: ' + data.error);
          }
        });
      }
    });

  </script>

</body>

</html>